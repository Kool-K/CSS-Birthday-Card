<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Happy Birthday Kaka</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&family=Lobster+Two:ital,wght@1,700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- GLOBAL RESET --- */
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #000;
        font-family: "Poppins", sans-serif;
        height: 100vh;
        width: 100vw;
      }

      /* =========================================
           1. THE 3D SPINNER (INTRO)
           ========================================= */
      #intro-layer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        perspective: 800px;
        overflow: hidden;
        transition: opacity 1s ease-out;
      }

      .spinner-box {
        position: relative;
        transform-style: preserve-3d;
        animation: spinIntro 12s linear infinite;
      }

      .spinner-box span {
        position: absolute;
        top: 0;
        left: 0;
        font-size: 6vmin;
        line-height: 1;
        color: #fff;
        white-space: nowrap;
        text-transform: uppercase;
        transform-origin: center;
        transform-style: preserve-3d;
        transform: rotateX(calc(var(--i) * 30deg)) translateZ(25vmin);
        backface-visibility: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        margin-left: -50vw;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      }

      .spinner-box span i {
        color: #ff0055;
        font-style: normal;
        margin-left: 0.2em;
      }

      @keyframes spinIntro {
        0% { transform: rotateX(0deg); }
        100% { transform: rotateX(360deg); }
      }

      /* =========================================
           2. THE LIVING ROOM SCENE
           ========================================= */
      #room-layer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 2s ease-in;
        
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Distribute space smartly so nothing touches edges */
        justify-content: space-evenly; 
        
        /* Add padding so content stays away from screen bezel */
        padding: 2vh 2vw; 

        background: radial-gradient(circle at center, #333 0%, #000 100%);
        background-image: url("background.png");
        background-size: cover;
        background-position: center;
      }

      /* --- FRAME CSS --- */
      .frame-container {
        position: relative;
        
        /* Default Portrait Settings */
        width: 80vw;
        max-width: 400px;
        aspect-ratio: 3 / 4; 
        
        /* Important: Don't let it get taller than 40% of screen height 
           initially, to save room for text */
        max-height: 45vh; 

        border: 12px solid #3e2723;
        border-radius: 4px;
        background: #000;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
        
        overflow: hidden;
        transform: perspective(1000px) rotateX(5deg);
        flex-shrink: 1; /* Allow shrinking if screen is tiny */
      }

      .frame-container::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 4px solid #d4af37;
        pointer-events: none;
        z-index: 10;
      }

      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }

      .jigsaw-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0;
        transition: opacity 2s ease;
        mix-blend-mode: normal;
        z-index: 5;
        background-image: url("data:image/svg+xml,%3Csvg width='50' height='50' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M100 0 H0 V100 H100 V0 Z' fill='none' stroke='rgba(0,0,0,0.7)' stroke-width='3'/%3E%3Cpath d='M50 0 V20 A10 10 0 0 1 50 40 V50 H60 A10 10 0 0 0 80 50 H100' fill='none' stroke='rgba(0,0,0,0.7)' stroke-width='3'/%3E%3Cpath d='M0 50 H20 A10 10 0 0 1 40 50 H50 V60 A10 10 0 0 0 50 80 V100' fill='none' stroke='rgba(0,0,0,0.7)' stroke-width='3'/%3E%3C/svg%3E");
        background-size: 50px 50px;
      }

      /* =========================================
           3. TEXT STYLES 
           ========================================= */
      .text-container {
        text-align: center;
        z-index: 20;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Minimize gaps */
        gap: 2vh; 
      }

      .masked-text {
        font-size: clamp(2rem, 5vw, 4rem);
        font-weight: 900;
        margin: 0;
        line-height: 1;
        text-transform: uppercase;
        color: transparent;
        background-image: url("https://images.unsplash.com/photo-1507166763745-bfe008fbb831?q=80&w=1170&auto=format&fit=crop");
        background-size: 200%;
        background-position: 0 50%;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: animate-background 5s infinite alternate linear;
        filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.5));
      }

      @keyframes animate-background {
        0% { background-position: 0 50%; }
        100% { background-position: 100% 50%; }
      }

      /* --- SPLIT TEXT (THANK YOU) --- */
      .split-text {
        position: relative;
        margin: 0;
        padding: 0;
        font-size: clamp(1.8rem, 4vw, 3.5rem);
        color: transparent;
        text-transform: uppercase;
        font-weight: 900;
        letter-spacing: 2px;
        cursor: pointer;
        height: 1.2em;
        filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.8));
        max-width: 90vw;
        line-height: 1.2;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      .split-text span:nth-child(1),
      .split-text span:nth-child(2) {
        position: absolute;
        top: 0;
        left: 0;
        color: #e0e0e0;
        transition: 0.5s;
        overflow: visible;
        width: 100%;
      }

      .split-text span:nth-child(1) { clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%); }
      .split-text span:nth-child(2) { clip-path: polygon(0 50%, 100% 50%, 100% 100%, 0 100%); }

      .split-text span:nth-child(3) {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scaleY(0);
        width: 100%;
        color: #000;
        background: #d4af37;
        font-size: 0.35em;
        font-weight: 700;
        letter-spacing: 0.2em;
        text-align: center;
        transition: 0.5s;
        padding: 5px 0;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        z-index: 1;
      }

      @media (hover: hover) {
        .split-text:hover span:nth-child(1) { transform: translateY(-0.6em); }
        .split-text:hover span:nth-child(2) { transform: translateY(0.6em); }
        .split-text:hover span:nth-child(3) { transform: translate(-50%, -50%) scaleY(1); }
      }

      .split-text.active span:nth-child(1) { transform: translateY(-0.6em); }
      .split-text.active span:nth-child(2) { transform: translateY(0.6em); }
      .split-text.active span:nth-child(3) { transform: translate(-50%, -50%) scaleY(1); }

      /* --- WAVE TEXT UPDATED --- */
      .wave-text {
        font-size: clamp(1rem, 3vw, 1.5rem);
        font-family: "Lobster Two", cursive;
        color: #000000;
        letter-spacing: 1px;
        margin-top: 0; /* Removed margin to save space */
        
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.1em; 
      }
      
      .word {
          display: inline-block;
          white-space: nowrap; 
          margin: 0 0.25em;    
      }

      .word span {
        display: inline-block;
        animation: wave 1.5s ease-in-out infinite;
      }

      @keyframes wave {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); } 
      }

      #upload-btn {
        position: absolute;
        z-index: 50;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 12px 25px;
        background: #d4af37;
        border: none;
        border-radius: 30px;
        font-weight: bold;
        cursor: pointer;
        display: none;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
      }

      /* =========================================
         LANDSCAPE / HORIZONTAL MODE FIXES
         ========================================= */
      @media (orientation: landscape) {
          /* When screen is horizontal, height is the limiting factor */
          .frame-container {
              /* Shrink frame to fit */
              height: 40vh; 
              width: auto; /* Width auto-calculates from aspect-ratio */
              aspect-ratio: 3/4;
              margin-bottom: 2vh;
          }
          
          /* Force text to scale down based on HEIGHT (vh) not width */
          .masked-text { font-size: 7vh; }
          .split-text { font-size: 6vh; margin: 1vh 0; }
          .wave-text { font-size: 4vh; }
          .text-container { gap: 1vh; }
      }

    </style>
  </head>
  <body>
    <div id="intro-layer">
      <div class="spinner-box">
        <span style="--i: 1">Happy <i>Birthday</i></span>
        <span style="--i: 2">Dear <i>Kaka</i></span>
        <span style="--i: 3">Happy <i>Birthday</i></span>
        <span style="--i: 4">Dear <i>Kaka</i></span>
        <span style="--i: 5">Happy <i>Birthday</i></span>
        <span style="--i: 6">Dear <i>Kaka</i></span>
        <span style="--i: 7">Happy <i>Birthday</i></span>
        <span style="--i: 8">Dear <i>Kaka</i></span>
        <span style="--i: 9">Happy <i>Birthday</i></span>
        <span style="--i: 10">Dear <i>Kaka</i></span>
        <span style="--i: 11">Happy <i>Birthday</i></span>
        <span style="--i: 12">Dear <i>Kaka</i></span>
      </div>
    </div>
    
    <div id="room-layer">
      <div class="frame-container" id="frame">
        <canvas id="photo-canvas"></canvas>
        <div class="jigsaw-overlay" id="puzzle-overlay"></div>
        <input
          type="file"
          id="fileInput"
          style="display: none"
          accept="image/*"
        />
        <button id="upload-btn">Tap to Add Photo</button>
      </div>
      
      <div class="text-container">
        <h1 class="masked-text">Happy Birthday Kaka</h1>
        
        <h2 class="split-text" onclick="this.classList.toggle('active')">
          Thank You
          <span>Thank You</span>
          <span>Thank You</span>
          <span>For Everything</span>
        </h2>
        
        <div class="wave-text">
          <div class="word">
            <span style="animation-delay: 0.0s">M</span>
            <span style="animation-delay: 0.1s">a</span>
            <span style="animation-delay: 0.2s">y</span>
          </div>
          <div class="word">
            <span style="animation-delay: 0.3s">2</span>
            <span style="animation-delay: 0.4s">0</span>
            <span style="animation-delay: 0.5s">2</span>
            <span style="animation-delay: 0.6s">6</span>
          </div>
          <div class="word">
            <span style="animation-delay: 0.7s">b</span>
            <span style="animation-delay: 0.8s">r</span>
            <span style="animation-delay: 0.9s">i</span>
            <span style="animation-delay: 1.0s">n</span>
            <span style="animation-delay: 1.1s">g</span>
          </div>
          <div class="word">
            <span style="animation-delay: 1.2s">y</span>
            <span style="animation-delay: 1.3s">o</span>
            <span style="animation-delay: 1.4s">u</span>
          </div>
          <div class="word">
            <span style="animation-delay: 1.5s">l</span>
            <span style="animation-delay: 1.6s">o</span>
            <span style="animation-delay: 1.7s">t</span>
            <span style="animation-delay: 1.8s">s</span>
          </div>
          <div class="word">
            <span style="animation-delay: 1.9s">o</span>
            <span style="animation-delay: 2.0s">f</span>
          </div>
          <div class="word">
            <span style="animation-delay: 2.1s">h</span>
            <span style="animation-delay: 2.2s">a</span>
            <span style="animation-delay: 2.3s">p</span>
            <span style="animation-delay: 2.4s">p</span>
            <span style="animation-delay: 2.5s">i</span>
            <span style="animation-delay: 2.6s">n</span>
            <span style="animation-delay: 2.7s">e</span>
            <span style="animation-delay: 2.8s">s</span>
            <span style="animation-delay: 2.9s">s</span>
          </div>
          <div class="word">
            <span style="animation-delay: 3.0s">a</span>
            <span style="animation-delay: 3.1s">n</span>
            <span style="animation-delay: 3.2s">d</span>
          </div>
          <div class="word">
            <span style="animation-delay: 3.3s">j</span>
            <span style="animation-delay: 3.4s">o</span>
            <span style="animation-delay: 3.5s">y</span>
          </div>
          <div class="word">
            <span style="animation-delay: 3.6s">!</span>
            <span style="animation-delay: 3.7s">!</span>
            <span style="animation-delay: 3.8s">!</span>
            <span style="animation-delay: 3.9s">!</span>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      const CONFIG = {
        introDuration: 5000,
        particleSize: 3,
        scanStep: 3,
        assembleSpeed: 0.02,
      };

      window.onload = () => {
        setTimeout(() => {
          const intro = document.getElementById("intro-layer");
          const room = document.getElementById("room-layer");
          intro.style.opacity = "0";
          setTimeout(() => {
            intro.style.display = "none";
            room.style.opacity = "1";
            loadImage();
          }, 1000);
        }, CONFIG.introDuration);
      };

      const canvas = document.getElementById("photo-canvas");
      const ctx = canvas.getContext("2d");
      const overlay = document.getElementById("puzzle-overlay");

      let width, height;
      let particles = [];
      let isAssembled = false;

      class Particle {
        constructor(finalX, finalY, color) {
          this.finalX = finalX;
          this.finalY = finalY;
          this.x = Math.random() * width;
          this.y = Math.random() * height * 2 - height;
          this.color = color;
        }

        update() {
          const dx = this.finalX - this.x;
          const dy = this.finalY - this.y;

          if (Math.abs(dx) < 0.5 && Math.abs(dy) < 0.5) {
            this.x = this.finalX;
            this.y = this.finalY;
          } else {
            this.x += dx * CONFIG.assembleSpeed;
            this.y += dy * CONFIG.assembleSpeed;
          }
        }

        draw() {
          ctx.fillStyle = this.color;
          ctx.fillRect(
            Math.floor(this.x),
            Math.floor(this.y),
            CONFIG.particleSize,
            CONFIG.particleSize,
          );
        }
      }

      function initParticles(img) {
        const frame = document.getElementById("frame");
        width = canvas.width = frame.clientWidth;
        height = canvas.height = frame.clientHeight;

        const tmpCanvas = document.createElement("canvas");
        const tmpCtx = tmpCanvas.getContext("2d");

        let scale = Math.max(width / img.width, height / img.height);
        let iw = img.width * scale;
        let ih = img.height * scale;
        let ox = (width - iw) / 2;
        let oy = (height - ih) / 2;

        tmpCanvas.width = width;
        tmpCanvas.height = height;
        tmpCtx.drawImage(img, ox, oy, iw, ih);

        const data = tmpCtx.getImageData(0, 0, width, height).data;
        particles = [];

        for (let y = 0; y < height; y += CONFIG.scanStep) {
          for (let x = 0; x < width; x += CONFIG.scanStep) {
            const index = (Math.floor(x) + Math.floor(y) * width) * 4;
            if (data[index + 3] > 128) {
              const col = `rgb(${data[index]},${data[index + 1]},${data[index + 2]})`;
              particles.push(new Particle(x, y, col));
            }
          }
        }

        isAssembled = false;
        overlay.style.opacity = "0";
        animate();

        setTimeout(() => {
          isAssembled = true;
          overlay.style.opacity = "1";
        }, 2000);
      }

      function animate() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, width, height);

        let allDone = true;
        particles.forEach((p) => {
          p.update();
          p.draw();
          if (Math.abs(p.x - p.finalX) > 1) allDone = false;
        });

        requestAnimationFrame(animate);
      }

      document.getElementById("frame").addEventListener("click", () => {
        overlay.style.opacity = "0";
        particles.forEach((p) => {
          p.x = Math.random() * width;
          p.y = Math.random() * height * 2 - height;
        });

        setTimeout(() => {
          overlay.style.opacity = "1";
        }, 2500);
      });

      function loadImage() {
        const img = new Image();
        img.src = "uncle.jpg";

        img.onload = () => initParticles(img);
        img.onerror = () => showUpload();
      }

      function showUpload() {
        const btn = document.getElementById("upload-btn");
        const input = document.getElementById("fileInput");
        btn.style.display = "block";

        btn.onclick = () => input.click();
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              const newImg = new Image();
              newImg.onload = () => {
                btn.style.display = "none";
                initParticles(newImg);
              };
              newImg.src = ev.target.result;
            };
            reader.readAsDataURL(file);
          }
        };
      }
    </script>
  </body>
</html>